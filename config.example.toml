# =============================================================================
# Kairos Validator Node Configuration
# =============================================================================
#
# This file contains all configuration options for running a Kairos validator.
# Copy this file to `config.toml` and modify values as needed.
#
# Environment variables can override any value using the NODE_ prefix.
# Nested fields use double underscore: NODE_CONSENSUS__N=6
#
# =============================================================================

# -----------------------------------------------------------------------------
# CONSENSUS CONFIGURATION
# -----------------------------------------------------------------------------
# Settings for the Minimmit BFT consensus protocol.

[consensus]
# Total number of validators in the network.
# Must satisfy: n >= 5f + 1 (e.g., n=6 for f=1, n=11 for f=2)
n = 6

# Maximum number of Byzantine (faulty) validators tolerated.
# The network can tolerate up to f Byzantine validators.
f = 1

# Maximum time to wait for a block proposal before sending a nullify message.
# If the leader doesn't propose within this timeout, validators will nullify the view.
# Format: { secs = <seconds>, nanos = <nanoseconds> }
view_timeout = { secs = 5, nanos = 0 }

# Leader selection strategy for determining which validator proposes each block.
# Options: "RoundRobin" (rotate through validators in order)
leader_manager = "round_robin"

# Network environment. Affects protocol parameters and peer discovery.
# Options: "local", "devnet", "testnet", "mainnet"
network = "local"

# List of validator BLS public keys (hex-encoded).
# These are the BLS keys used for consensus voting and aggregation.
# In production, this should list all validators in the network.
peers = [
    "807f9f8d2719aadcb49ea61c3adb335b1ac6bddab67c324aa7805a67f5a51790abe2907d974925df9627698a6ad27d220681be9b888fdd89069b4870a9adea53e9e1211dafb9c83087cdbd87b88bb961a17aacf39de54af62605dd83e12fafce",
    "85e6114fa95fe428edde374dff0c1cc879d59ec48ab7bda0c2fefc73b59a0b112a57b56ca2bb79e6278b61362f36158102cbd2c4097144eb9eefd65425e1f969c9f29d32f8b1a29320b37d24642cc5f55c1834bb0471265a316adbfef95b6282",
    "8a3d0a78a548a4fb4876dadf47d6f6f0e68bea03ace77b33137a3a3f78ea7b2df1ded6add85899a1aae9ee7c08f0f678124b5abd93501cb520ea7db02a92007a771a45f579ac12fdb52a656d11ca5fa1c7bea0db82565def8ee141df172a181e",
    "99cc527ab2fdde759eaa0d80f41be2a239115896bd974ce6a2f2ebf88338185e026b79be721de193664c180d01a43a8d01864274430841546be07d1676cefdcd94254fb0b415bf5d3583e78e09ac2f94c2b03690d79a16bdacccaee91bb51a72",
    "a12b306597f491c886c418e06f9d4b6816948788e983e48d57262d154fc3560d294197ddc5f81ecdea1ec9b720a830d80c58efaffbcd711523864c07adbf56eb3eec4199d416e7b8e37f08152a5432bc325fe6932a9ae856cb8eee72a658a69f",
    "a87b2437da786106e26949b2bcbabe9e453587b0340cd0b466bc83bf61d61d0c6240f8b6e0a63d25bf2d34fa5d9ffd4914fbddf11e347d6553c09dc1430e3be614bd685e374435880cf2ebef0408885a3515e3e5d9e9aae84fe3d12c13b97d96",
]

# Genesis accounts with initial token balances.
# These accounts are created at network genesis with the specified balances.
[[consensus.genesis_accounts]]
balance    = 1000000000                                                         # Initial balance in base units
public_key = "9af8324634d5858251ace90e8a10a1d7fd96c4264bfd3108e74ec88c01f2de0c" # Ed25519 public key (hex)

[[consensus.genesis_accounts]]
balance    = 500000000
public_key = "db5f654c0b6515a9cf83ec3d424ada47dac72e6b16d43fe296b034e29d156cc0"

# -----------------------------------------------------------------------------
# STORAGE CONFIGURATION
# -----------------------------------------------------------------------------
# Persistent storage settings for blocks, state, and consensus data.

[storage]
# Path to the data directory for RocksDB storage.
# This directory will be created if it doesn't exist.
# Should have sufficient disk space for blockchain data.
path = "/var/lib/kairos/data"

# -----------------------------------------------------------------------------
# P2P CONFIGURATION
# -----------------------------------------------------------------------------
# Peer-to-peer networking settings for validator communication.

[p2p]
# Local address to bind for incoming P2P connections.
# Use 0.0.0.0 to listen on all interfaces.
listen_addr = "0.0.0.0:9000"

# External address that other validators should use to connect.
# This should be your public IP if behind NAT, or same as listen_addr otherwise.
external_addr = "1.2.3.4:9000"

# Total number of peers in the consensus network.
# Should match consensus.n
total_number_peers = 6

# Maximum faulty peers in the network.
# Should match consensus.f
maximum_number_faulty_peers = 1

# Cluster ID for network namespace (prevents cross-network message replay).
# All validators in the same network must use the same cluster_id.
cluster_id = "kairos-mainnet"

# Maximum size of a single P2P message in bytes.
# Default: 1MB (1048576 bytes)
max_message_size = 1048576

# Maximum number of pending messages in the receive buffer.
# Increase if experiencing message drops under high load.
message_backlog = 1024

# Rate limit for consensus protocol messages (votes, proposals) per second.
# Protects against DoS attacks from malicious peers.
consensus_rate_per_second = 10000

# Rate limit for transaction gossip messages per second.
# Should be set based on expected transaction throughput.
tx_rate_per_second = 50000

# Timeout for P2P bootstrap phase in milliseconds.
# How long to wait for initial peer connections before proceeding.
bootstrap_timeout_ms = 30000

# Interval between ping messages during bootstrap (milliseconds).
# Lower values speed up peer discovery but increase network overhead.
ping_interval_ms = 500

# Size of the transaction broadcast queue.
# Transactions waiting to be gossiped to peers.
tx_broadcast_queue_size = 100000

# List of known validators (bootstrap peers).
# At least one validator should be reachable for initial network discovery.
[[p2p.validators]]
# Ed25519 public key for P2P identity (hex-encoded, 32 bytes)
ed25519_public_key = "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"
# BLS peer ID for consensus (matches index in consensus.peers)
bls_peer_id = 0
# Direct socket address (optional, for bootstrap)
address = "192.168.1.1:9000"

[[p2p.validators]]
address            = "192.168.1.2:9000"
bls_peer_id        = 1
ed25519_public_key = "123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0"

[[p2p.validators]]
address            = "192.168.1.3:9000"
bls_peer_id        = 2
ed25519_public_key = "23456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef01"

[[p2p.validators]]
address            = "192.168.1.4:9000"
bls_peer_id        = 3
ed25519_public_key = "3456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef012"

[[p2p.validators]]
address            = "192.168.1.5:9000"
bls_peer_id        = 4
ed25519_public_key = "456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123"

[[p2p.validators]]
address            = "192.168.1.6:9000"
bls_peer_id        = 5
ed25519_public_key = "56789abcdef0123456789abcdef0123456789abcdef0123456789abcdef01234"

# -----------------------------------------------------------------------------
# RPC (gRPC) CONFIGURATION
# -----------------------------------------------------------------------------
# External gRPC API server settings for client interactions.

[rpc]
# Address to listen for gRPC client connections.
# Use 0.0.0.0 to accept connections from any interface.
listen_addr = "0.0.0.0:50051"

# Maximum concurrent gRPC streams per connection.
# Higher values allow more parallel requests but use more memory.
max_concurrent_streams = 100

# Request timeout in seconds.
# Requests taking longer than this will be cancelled.
request_timeout_secs = 30

# This validator's peer ID (must match position in consensus.peers).
# Used for identifying this node in API responses.
peer_id = 0

# Network environment for API responses.
# Options: "mainnet", "testnet", "local"
network = "local"

# Total number of validators (for API info endpoints).
# Should match consensus.n
total_validators = 6

# Fault tolerance parameter (for API info endpoints).
# Should match consensus.f
f = 1

# -----------------------------------------------------------------------------
# IDENTITY CONFIGURATION
# -----------------------------------------------------------------------------
# Validator key management settings.

[identity]
# Path to the BLS secret key file (hex-encoded).
# This key is used for consensus voting and block signing.
# If not provided or file doesn't exist, a new key will be generated.
# SECURITY: This file must be kept secure and backed up.
bls_secret_key_path = "/etc/kairos/keys/bls.key"

# Path to the Ed25519 secret key file for P2P identity.
# This key is used for authenticating P2P connections.
# If not provided or file doesn't exist, a new key will be generated.
# SECURITY: This file must be kept secure and backed up.
ed25519_secret_key_path = "/etc/kairos/keys/ed25519.key"

# -----------------------------------------------------------------------------
# VISUALIZER CONFIGURATION
# -----------------------------------------------------------------------------
# Embedded web UI for real-time consensus state visualization.
# Shows view progression, vote accumulation, M/L-notarizations, and nullifications.

[visualizer]
# Enable the visualizer HTTP server.
enabled = false

# Socket address for the visualizer dashboard.
# Open this URL in a browser to view consensus state in real-time.
listen_address = "127.0.0.1:8080"

# -----------------------------------------------------------------------------
# METRICS CONFIGURATION
# -----------------------------------------------------------------------------
# Prometheus metrics exporter. When enabled, exposes a /metrics HTTP endpoint.

[metrics]
# Enable the Prometheus HTTP endpoint.
enabled = false

# Socket address for the /metrics endpoint.
# Prometheus should be configured to scrape this address.
listen_address = "127.0.0.1:9090"

# -----------------------------------------------------------------------------
# LOGGING CONFIGURATION
# -----------------------------------------------------------------------------
# Structured logging output settings.

[logging]
# Output format. Options: "terminal" (human-readable), "json" (structured)
format = "terminal"

# Minimum log level. Options: "error", "warn", "info", "debug"
level = "info"

# Optional file path for log output.
# If not set, logs are written to stdout.
# file = "/var/log/kairos/node.log"

# =============================================================================
# RPC NODE CONFIGURATION (for read-only syncing nodes)
# =============================================================================
#
# RPC nodes sync finalized blocks from validators but do NOT participate in
# consensus. They serve read-only gRPC queries to external clients.
#
# To run an RPC node, use the `rpc-node` binary with `--config rpc-config.toml`
# Create a separate config file with just the [rpc_node] section below.
#
# =============================================================================

# Uncomment and save to a separate file (e.g., rpc-config.toml) for RPC nodes:

[rpc_node]
# gRPC server address for client queries
grpc_addr = "0.0.0.0:50051"

# P2P address for validator connections
p2p_addr = "0.0.0.0:9000"

# Data directory for block storage
data_dir = "./rpc-data"

# Cluster ID (must match validator network)
cluster_id = "kairos-mainnet"

# Path to identity file (persists Ed25519 key across restarts)
# If not set, generates new identity each run
identity_path = "./rpc-data/identity.key"

# Validators to sync from (need BLS public key for L-notarization verification)
[[rpc_node.validators]]
address            = "192.168.1.100:9000"
bls_peer_id        = 12345678901234567890
bls_public_key     = "abcd1234..."                                                      # Required for L-notarization verification
ed25519_public_key = "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"
